---
import SEO from "../components/SEO.astro";
import Header from "../components/Header.astro";
import Footer from "../components/Footer.astro";
import ContactSection from "../components/ContactSection.astro";
import SkipLink from "../components/SkipLink.astro";
import ImageLightbox from "../components/ImageLightbox.astro";
import { site } from "../content/site";
import Cloudfare from "../components/Cloudfare.astro";

import "../styles/global.css";

const {
  title = site.name,
  description = site.description,
  canonicalPath = Astro.url.pathname,
  ogImage = site.seo.ogImage,
  robots = site.seo.robots,
  jsonLd,
  mainCentered = false,
  showHeader = true,
  showFooter = true,
  showContactSection = showFooter,
  bodyClass = ""
} = Astro.props;
const CF_TOKEN = import.meta.env.PUBLIC_CF_BEACON_TOKEN || "";
const canonical = new URL(canonicalPath, site.url).toString();

// Allow Google Fonts stylesheet in CSP (Astro generates script/style hashes; we add external style source)
Astro.csp.insertDirective("style-src https://fonts.googleapis.com");
---

<!doctype html>
<!--
     ____            _     _             
    |  _ \ ___  ___(_)___(_)_ __   __ _ 
    | |_) / _ \/ __| |_  / | '_ \ / _` |
    |  _ <  __/\__ \ |/ /| | | | | (_| |
    |_| \_\___||___/_/___|_|_| |_|\__, |
                                   |___/ 
    
    Â© Resizing 2025
    Resizing.ca
    
    Simple websites for small businesses
    
    Developed by: Wyatt Lain & Resizing Studio
    
-->
<html lang={site.locale}>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="theme-color" content={site.seo.themeColor} />

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" media="print" id="fonts-stylesheet" />
    <noscript><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" /></noscript>
    <script>
      (function () {
        const el = document.getElementById("fonts-stylesheet");
        if (!el) return;
        if (el.sheet) el.media = "all";
        else el.addEventListener("load", function () { this.media = "all"; });
      })();
    </script>

    <SEO
      title={title}
      description={description}
      canonical={canonical}
      ogImage={ogImage}
      robots={robots}
      jsonLd={jsonLd}
    />
    <Cloudfare token={CF_TOKEN} />
  </head>

  <body class={`page ${bodyClass}`.trim()}>
    <div class="page__content">
      <SkipLink />
      {showHeader && <Header />}
      <main id="main" class={`page__main ${mainCentered ? "page__main--centered" : ""}`}>
        <slot />
      </main>
      {showContactSection && <ContactSection />}
    </div>
    {showFooter && (
      <div class="reveal-footer">
        <Footer />
      </div>
    )}
    <ImageLightbox />
  </body>
</html>
