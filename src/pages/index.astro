---
import Base from "../layouts/Base.astro";
import CursorSwitcher from "../components/CursorSwitcher.astro";
import { site } from "../content/site";

const jsonLd = {
  "@context": "https://schema.org",
  "@type": "WebSite",
  name: site.name,
  url: site.url,
  inLanguage: site.locale
};
---

<Base
  title={site.name}
  description={site.description}
  canonicalPath="/"
  jsonLd={jsonLd}
  showHeader={false}
  showFooter={false}
>
  <div class="page-layout">
    <div class="page-content">
      <!-- Header with brand (outside above-fold for full-page sticky) -->
      <div class="header-brand">
        <span class="logo-text">Resizing</span>
      </div>

      <div class="above-fold">
        <!-- Main Content Area -->
        <div class="content-layout">
          <!-- Left Column: Text Content -->
          <div class="content-left">
            <div class="text-content">
              <p class="description">Simple, effective websites for small businesses that deserve to look great online — without the complexity or big agency price tag.</p>
              <a href="/contact" class="inquire-button">Reach Out</a>
            </div>
          </div>

          <!-- Right Column: Visual Space -->
          <div class="content-right">
            <!-- Space reserved for visual content -->
          </div>
        </div>

        <hr class="hero-divider" />

        <section class="services-section">
          <div class="services-left">
            <h2 class="section-title">The work we do, and who we do it for.</h2>
            <div class="section-body">
              <p>We design affordable websites for <span class="highlight">small businesses</span> that feel refined, considered, and cohesive. Our approach keeps <span class="highlight">costs low</span> while giving you a clean, consistent online presence where every touchpoint feels intentional, from the first scroll to the final click.</p>
              <p>A standard collaboration typically spans <span class="highlight">2 to 3 weeks</span>, taking us from initial strategy all the way to the final deployment and launch.</p>
            </div>
          </div>
          <div class="services-right">
            <video class="services-video" autoplay muted loop playsinline>
              <source src="/PureGlow-ex.mp4" type="video/mp4" />
            </video>
          </div>
        </section>
      </div>

      <section class="cards-section">
        <div class="card">
          <span class="card-number">01</span>
          <h3 class="card-title">Web Development</h3>
          <p class="card-body">We replace renting slow, fragile platforms with owning a custom-engineered asset that offers superior speed, security, and long-term investment value.</p>
          <p class="card-price">Projects start from $500</p>
        </div>
        <div class="card">
          <span class="card-number">02</span>
          <h3 class="card-title">Hosting & Maintenance</h3>
          <p class="card-body">Your websites are hosted on Cloudflare Pages, which connects directly to our GitHub repositories. When we update your site, we simply push changes to GitHub, and Cloudflare automatically detects the commit, builds the project, and deploys it live within minutes.</p>
        </div>
        <div class="card">
          <span class="card-number">03</span>
          <h3 class="card-title">Branding</h3>
          <p class="card-body">We create cohesive brand identities that resonate with your audience. From logo design to complete visual systems, we ensure your brand feels refined and intentional across every touchpoint.</p>
        </div>
      </section>

      <!-- Vertical Navigation on the right -->
      <nav class="vertical-nav">
        <a href="/services" class="nav-item">Services</a>
        <a href="/studio" class="nav-item">Studio</a>
        <a href="/work" class="nav-item">Work</a>
        <a href="/contact" class="nav-item">Contact</a>
        <CursorSwitcher />
      </nav>
    </div>

    <!-- Spacer creates scroll room for the pin phase -->
    <div class="scroll-pin-spacer"></div>
  </div>
</Base>

<style is:global>
  .page__main:has(.page-layout) {
    padding-left: 0 !important;
    padding-right: 0 !important;
  }
</style>

<style>
  /* Page Layout */
  .page-layout {
    position: relative;
    min-height: 100vh;
    padding: 10px;
  }

  /* Sticky wrapper: pins all content while the spacer scrolls behind.
     top: 10px matches the parent's padding so the pin is immediate —
     no natural scroll before the sticky threshold. */
  .page-content {
    position: sticky;
    top: 10px;
    z-index: 1;
  }

  /* Creates extra scroll height so the page can "scroll"
     while content stays pinned (matches LOGO_SHRINK_RANGE in JS) */
  .scroll-pin-spacer {
    height: 400px;
    pointer-events: none;
  }

  /* Header Brand */
  .header-brand {
    position: sticky;
    top: 10px;
    z-index: 101;
    animation: fadeInUp 0.8s ease-out forwards;
    opacity: 0;
    margin-bottom: 12px;
    transition: transform 0.4s ease-out, opacity 0.4s ease-out;

    /* JS-controlled custom properties for the header bar */
    --header-line-top: 78px;
    --header-opacity: 0;
  }

  /* When shrunk, remove sticky and move out of view */
  .header-brand.shrunk {
    position: relative;
    transform: translateY(-120px);
    opacity: 0;
    pointer-events: none;
  }

  /* White background — masks content scrolling behind the header */
  .header-brand::before {
    content: '';
    position: absolute;
    top: -10px;                /* reach viewport top */
    left: -10px;
    width: 100vw;
    height: calc(var(--header-line-top) + 14px); /* cover logo + line + buffer */
    background: #fff;
    opacity: var(--header-opacity);
    z-index: -1;
    pointer-events: none;
  }

  /* Divider line — sits at the visual bottom of the shrunken logo */
  .header-brand::after {
    content: '';
    position: absolute;
    top: var(--header-line-top);
    left: -10px;
    width: 100vw;
    height: 1px;
    background: rgba(0, 0, 0, 0.12);
    opacity: var(--header-opacity);
    pointer-events: none;
  }

  .logo-text {
    font-size: 78px;
    font-weight: 600;
    letter-spacing: -0.03em;
    line-height: 1;
    display: block;
    color: #000;
    font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    transform-origin: top left;
    will-change: transform;
    position: relative;
    z-index: 1;
  }

  /* Vertical Navigation on Right */
  .vertical-nav {
    position: fixed;
    top: 10px;
    right: 10px;
    display: flex;
    flex-direction: column;
    align-items: flex-end;
    gap: 4px;
    z-index: 100;
  }

  .nav-item,
  .vertical-nav > :global(*) {
    transition: opacity 0.2s ease-out, transform 0.2s ease-out;
  }

  .nav-item {
    font-size: 20px;
    font-weight: 600;
    color: #000;
    text-decoration: none;
    text-align: right;
    line-height: 1.4;
  }

  .nav-item:hover {
    opacity: 0.7;
  }

  /* Two Column Content Layout */
  .content-layout {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 80px;
    max-width: 1400px;
    margin: 0;
    padding: 0 0 0 0;
    padding-right: 240px; /* Space for fixed nav */
  }

  .content-left {
    display: flex;
    align-items: flex-start;
    justify-content: flex-start;
  }

  .text-content {
    max-width: 400px;
    font-size: 72px; /* match logo-text size so children can use em units relative to it */
    display: flex;
    flex-direction: column;
    align-items: flex-start;
    gap: 12px;
  }

  .content-right {
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .description {
    font-size: 0.25em;
    font-weight: 400;
    margin: 0;
    line-height: 1.5;
    color: #444;
    opacity: 0;
    animation: fadeInUp 0.8s ease-out 0.3s forwards;
  }

  .inquire-button {
    display: inline-block;
    padding: 0;
    background: none;
    color: #000;
    text-decoration: none;
    border-radius: 0;
    font-size: 13px;
    font-weight: 600;
    letter-spacing: 0.04em;
    text-transform: uppercase;
    transition: opacity 0.2s ease;
    border: none;
    border-bottom: 1.5px solid #000;
    padding-bottom: 2px;
    animation: fadeInUp 0.8s ease-out 0.7s forwards;
    opacity: 0;
    margin-top: 4px;
  }

  .inquire-button:hover {
    opacity: 0.6;
  }

  .hero-divider {
    border: none;
    border-top: 1px solid rgba(0, 0, 0, 0.12);
    margin: 96px 0 0 0;
    width: 100vw;
    position: relative;
    left: 50%;
    right: 50%;
    margin-left: -50vw;
    margin-right: -50vw;
    animation: fadeInUp 0.8s ease-out 0.9s forwards;
    opacity: 0;
    z-index: 10;
    will-change: transform;
  }

  .services-section {
    padding: 36px 0 0 0;
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 40px;
    align-items: start;
    animation: fadeInUp 0.8s ease-out 1.1s forwards;
    opacity: 0;
  }

  .services-left {
    display: flex;
    flex-direction: column;
  }

  .services-right {
    display: flex;
    align-items: stretch;
    justify-content: center;
    align-self: stretch;
  }

  .services-video {
    width: 100%;
    max-width: 420px;
    height: 100%;
    object-fit: cover;
    border-radius: 4px;
    display: block;
  }

  .section-title {
    font-size: 36px;
    font-weight: 600;
    letter-spacing: -0.02em;
    line-height: 1.2;
    color: #000;
    margin: 0;
  }

  .section-body {
    margin-top: 20px;
    max-width: 560px;
    display: flex;
    flex-direction: column;
    gap: 16px;
    animation: fadeInUp 0.8s ease-out 1.3s forwards;
    opacity: 0;
  }

  .section-body p {
    font-size: 16px;
    font-weight: 400;
    line-height: 1.6;
    color: #444;
    margin: 0;
  }

  .highlight {
    color: #999;
    font-style: italic;
  }

  /* Above Fold Wrapper */
  .above-fold {
    min-height: 100vh;
    box-sizing: border-box;
    will-change: transform;
  }

  /* Cards Section */
  .cards-section {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 10px;
    margin-top: 0;
    width: 100vw;
    position: relative;
    left: 50%;
    right: 50%;
    margin-left: -50vw;
    margin-right: -50vw;
    padding: 10px;
    box-sizing: border-box;
    animation: fadeInUp 0.8s ease-out 1.5s forwards;
    opacity: 0;
  }

  .card {
    background: #f5f5f5;
    border-radius: 10px;
    padding: 32px 28px;
    display: flex;
    flex-direction: column;
    gap: 0;
  }

  .card-number {
    font-size: 13px;
    font-weight: 400;
    color: #999;
    letter-spacing: 0.02em;
    margin-bottom: 8px;
  }

  .card-title {
    font-size: 24px;
    font-weight: 600;
    color: #000;
    margin: 0 0 20px 0;
    letter-spacing: -0.01em;
    line-height: 1.2;
  }

  .card-body {
    font-size: 14px;
    font-weight: 400;
    line-height: 1.65;
    color: #555;
    margin: 0;
  }

  .card-price {
    font-size: 14px;
    font-weight: 600;
    color: #000;
    margin: 12px 0 0 0;
  }

  @keyframes fadeInUp {
    from {
      opacity: 0;
      transform: translateY(20px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  /* Responsive Design */
  @media (max-width: 1024px) {
    .content-layout {
      grid-template-columns: 1fr;
      gap: 40px;
      padding: 0;
      padding-right: 0;
    }

    .services-section {
      grid-template-columns: 1fr;
      gap: 40px;
    }

    .cards-section {
      grid-template-columns: 1fr;
      margin-top: 48px;
    }


    .vertical-nav {
      position: static;
      align-items: flex-start;
      margin-top: 40px;
    }

    .text-content {
      max-width: 400px;
    }
  }

  @media (max-width: 768px) {
    .page-layout {
      padding: 8px 10px;
    }

    .content-layout {
      padding: 0;
    }

    .vertical-nav {
      right: 10px;
    }

    .text-content {
      font-size: 56px;
    }

    .description {
      margin-bottom: 0;
    }

    .inquire-button {
      padding: 6px 14px !important;
      font-size: 12px;
    }
  }
</style>

<script>
  function initScrollEffects() {
    const logo = document.querySelector('.logo-text') as HTMLElement | null;
    const headerBrand = document.querySelector('.header-brand') as HTMLElement | null;
    const aboveFold = document.querySelector('.above-fold') as HTMLElement | null;
    const heroDivider = document.querySelector('.hero-divider') as HTMLElement | null;
    const nav = document.querySelector('.vertical-nav') as HTMLElement | null;

    if (!logo || !headerBrand || !aboveFold || !nav) return;

    const children = Array.from(nav.children) as HTMLElement[];
    const gap = 4; // matches the CSS gap on .vertical-nav

    // Measure each nav item's natural height at init
    const heights = children.map(el => el.offsetHeight);

    // The logo's layout height (font-size × line-height 1 = 78px)
    const LOGO_HEIGHT = logo.offsetHeight;

    // ── Logo shrink configuration ──
    const LOGO_SHRINK_START = 0;     // begin shrinking immediately
    const LOGO_SHRINK_RANGE = 400;   // scroll px over which logo shrinks (slower)
    const MIN_SCALE = 0.32;          // minimum scale (~25px from 78px)

    // ── Nav fade configuration (delayed until logo shrink completes) ──
    const NAV_SCROLL_START = LOGO_SHRINK_START + LOGO_SHRINK_RANGE;
    const FADE_RANGE = 25;           // scroll px for an item to fade out
    const COLLAPSE_RANGE = 20;       // scroll px for items below to move up
    const SLIDE_PX = 8;              // small upward drift during fade
    const STEP = FADE_RANGE + COLLAPSE_RANGE;

    // ── Header bar fade-in range (px the divider travels to fully reveal the header) ──
    const HEADER_FADE_PX = 30;

    function getLogoScale(scrollY: number): number {
      if (scrollY <= LOGO_SHRINK_START) return 1;
      if (scrollY >= LOGO_SHRINK_START + LOGO_SHRINK_RANGE) return MIN_SCALE;
      const progress = (scrollY - LOGO_SHRINK_START) / LOGO_SHRINK_RANGE;
      return 1 - progress * (1 - MIN_SCALE);
    }

    function getFadeProgress(scrollY: number, i: number): number {
      const fadeStart = NAV_SCROLL_START + i * STEP;
      if (scrollY <= fadeStart) return 0;
      if (scrollY >= fadeStart + FADE_RANGE) return 1;
      return (scrollY - fadeStart) / FADE_RANGE;
    }

    function getCollapseProgress(scrollY: number, i: number): number {
      const collapseStart = NAV_SCROLL_START + i * STEP + FADE_RANGE;
      if (scrollY <= collapseStart) return 0;
      if (scrollY >= collapseStart + COLLAPSE_RANGE) return 1;
      return (scrollY - collapseStart) / COLLAPSE_RANGE;
    }

    function onScroll() {
      const scrollY = window.scrollY;

      // ── Logo scaling (top-left anchored via transform-origin) ──
      const scale = getLogoScale(scrollY);
      logo.style.transform = `scale(${scale})`;

      // ── Once logo is fully shrunk, remove sticky positioning and move header out of view ──
      const isFullyShrunk = scrollY >= LOGO_SHRINK_START + LOGO_SHRINK_RANGE;
      if (isFullyShrunk) {
        headerBrand.classList.add('shrunk');
      } else {
        headerBrand.classList.remove('shrunk');
      }

      // ── Move content up to stay with the shrinking logo ──
      const gapToClose = LOGO_HEIGHT * (1 - scale);
      aboveFold.style.transform = `translateY(-${gapToClose}px)`;

      // ── Header bar: position the line at the visual bottom of the logo + small gap ──
      const visualLogoBottom = LOGO_HEIGHT * scale + 4; // 4px gap below text
      headerBrand.style.setProperty('--header-line-top', `${visualLogoBottom}px`);

      // ── Header bar: fade in as the hero-divider reaches the header area ──
      if (heroDivider && !isFullyShrunk) {
        const dividerTop = heroDivider.getBoundingClientRect().top;
        // The line's viewport position = header-brand sticky top (10px) + visualLogoBottom
        const headerLineY = 10 + visualLogoBottom;

        if (dividerTop <= headerLineY + HEADER_FADE_PX) {
          const progress = Math.min(
            1,
            Math.max(0, (headerLineY + HEADER_FADE_PX - dividerTop) / HEADER_FADE_PX)
          );
          headerBrand.style.setProperty('--header-opacity', String(progress));
        } else {
          headerBrand.style.setProperty('--header-opacity', '0');
        }
      }

      // ── Nav fading (only starts after logo shrink finishes) ──
      children.forEach((el, i) => {
        const fadeProgress = getFadeProgress(scrollY, i);

        let collapseOffset = 0;
        for (let j = 0; j < i; j++) {
          collapseOffset += (heights[j] + gap) * getCollapseProgress(scrollY, j);
        }

        const ownSlide = fadeProgress * SLIDE_PX;
        const totalY = collapseOffset + ownSlide;

        el.style.opacity = String(1 - fadeProgress);
        el.style.transform = `translateY(-${totalY}px)`;
        el.style.pointerEvents = fadeProgress >= 1 ? 'none' : 'auto';
      });
    }

    window.addEventListener('scroll', onScroll, { passive: true });
    onScroll();
  }

  initScrollEffects();
</script>
