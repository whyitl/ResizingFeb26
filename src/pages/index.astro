---
import Base from "../layouts/Base.astro";
import CursorSwitcher from "../components/CursorSwitcher.astro";
import ResponsiveLightboxImage from "../components/ResponsiveLightboxImage.astro";
import { site } from "../content/site";

import tucnHome from "../assets/images/TUCNHome.webp";
import tucnServices from "../assets/images/TUCNServices.webp";
import tucnReviews from "../assets/images/TUCNreviews.webp";
import pureGlowHome from "../assets/images/PureGlowHome.webp";
import pureGlowServices from "../assets/images/PureGlowServices.webp";
import pureGlowFaq from "../assets/images/PureGlowFAQ.webp";

const jsonLd = {
  "@context": "https://schema.org",
  "@type": "WebSite",
  name: site.name,
  url: site.url,
  inLanguage: site.locale
};
---

<Base
  title={site.name}
  description={site.description}
  canonicalPath="/"
  jsonLd={jsonLd}
  showHeader={false}
  showFooter={true}
>
  <div class="page-layout">
    <div class="page-content">
      <!-- Header with brand (outside above-fold for full-page sticky) -->
      <div class="header-brand">
        <a href="/" class="logo-text">Resizing</a>
      </div>

      <div class="above-fold">
        <!-- Main Content Area -->
        <div class="content-layout">
          <!-- Left Column: Text Content -->
          <div class="content-left">
            <div class="text-content">
              <p class="description">Simple, effective websites for small businesses that deserve to look great online — without the complexity or big agency price tag.</p>
            </div>
          </div>

          <!-- Right Column: Visual Space -->
          <div class="content-right">
            <!-- Space reserved for visual content -->
          </div>
        </div>

        <hr class="hero-divider" />

        <section class="services-section">
          <div class="services-left">
            <h2 class="section-title">The work we do, and who we do it for.</h2>
            <div class="section-body">
              <p>We design affordable websites for <span class="highlight">small businesses</span> that feel refined, considered, and cohesive. Our approach keeps <span class="highlight">costs low</span> while giving you a clean, consistent online presence where every touchpoint feels intentional, from the first scroll to the final click.</p>
              <p>A standard collaboration typically spans <span class="highlight">2 to 3 weeks</span>, taking us from initial strategy all the way to the final deployment and launch.</p>
              <a href="/contact" class="reach-out-button">Reach Out</a>
            </div>
          </div>
          <div class="services-right">
            <video id="services-video" class="services-video" muted loop playsinline preload="metadata" poster="/PureGlow-poster.webp" fetchpriority="high">
              <source src="/PureGlow-ex.mp4" type="video/mp4" />
            </video>
          </div>
        </section>
      </div>

      <section id="services" class="cards-section">
        <h2 class="cards-section-title">How We Help</h2>
        <div class="card">
          <span class="card-number">01</span>
          <h3 class="card-title">Web Development</h3>
          <p class="card-body">We replace renting slow, fragile platforms with owning a custom-engineered asset that offers superior speed, security, and long-term investment value.</p>
          <p class="card-price">Projects start from $500</p>
        </div>
        <div class="card">
          <span class="card-number">02</span>
          <h3 class="card-title">Hosting & Maintenance</h3>
          <p class="card-body">Your websites are hosted on Cloudflare Pages, which connects directly to our GitHub repositories. When we update your site, we simply push changes to GitHub, and Cloudflare automatically detects the commit, builds the project, and deploys it live within minutes.</p>
        </div>
        <div class="card">
          <span class="card-number">03</span>
          <h3 class="card-title">Branding</h3>
          <p class="card-body">We create cohesive brand identities that resonate with your audience. From logo design to complete visual systems, we ensure your brand feels refined and intentional across every touchpoint.</p>
        </div>
      </section>

      <section id="work" class="showcased-work-section">
        <h2 class="showcased-title">Showcased Work</h2>
        <div class="work-table">
          <div class="table-header">
            <div class="col-year">YEAR</div>
            <div class="col-client">CLIENT</div>
            <div class="col-type">NICHE</div>
            <div class="col-tech">TECHNOLOGY</div>
          </div>
          <div class="table-body">
            <div class="table-row is-open" data-accordion>
              <button class="row-summary" aria-expanded="true">
                <div class="col-year">2025</div>
                <div class="col-client">TUCN Media</div>
                <div class="col-type">Marketing</div>
                <div class="col-tech">React, Vite, Tailwind</div>
              </button>
              <div class="row-details">
                <div class="details-content">
                  <p class="details-description">
                    TUCN Media's site gives the Calgary-based creative studio a focused digital home to showcase their video, photo, and design work to local businesses and brands. Clean, spacious layouts keep the spotlight on bold visuals and case studies, making it easy for potential clients to understand what the studio does and how they work. Clear service breakdowns, concise copy, and straightforward navigation create a smooth, no-nonsense experience that reflects TUCN Media's practical, results-driven approach to content creation.
                  </p>
                  <div class="details-images details-images--3">
                    <ResponsiveLightboxImage src={tucnHome} alt="TUCN Media homepage" />
                    <ResponsiveLightboxImage src={tucnServices} alt="TUCN Media services" />
                    <ResponsiveLightboxImage src={tucnReviews} alt="TUCN Media reviews" />
                  </div>
                  <a href="https://tucnmedia.com" target="_blank" rel="noopener noreferrer" class="visit-site-btn">
                    Visit Site →
                  </a>
                </div>
              </div>
            </div>
            <div class="table-row" data-accordion>
              <button class="row-summary" aria-expanded="false">
                <div class="col-year">2025</div>
                <div class="col-client">PureGlow Electric</div>
                <div class="col-type">Trades (Electrical)</div>
                <div class="col-tech">React, TypeScript, Tailwind</div>
              </button>
              <div class="row-details">
                <div class="details-content">
                  <p class="details-description">
                    Pure Glow Electric's website provides a professional online presence for the electrical services company, making it simple for customers to learn about their services and get in touch. The site features clear service descriptions, contact information, and a user-friendly layout that helps visitors quickly find what they need.
                  </p>
                  <div class="details-images details-images--3">
                    <ResponsiveLightboxImage src={pureGlowHome} alt="Pure Glow Electric homepage" />
                    <ResponsiveLightboxImage src={pureGlowServices} alt="Pure Glow Electric services" />
                    <ResponsiveLightboxImage src={pureGlowFaq} alt="Pure Glow Electric FAQ" />
                  </div>
                  <a href="https://pureglowelectric.com" target="_blank" rel="noopener noreferrer" class="visit-site-btn">
                    Visit Site →
                  </a>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <section class="studio-section">
        <div class="studio-inner">
          <div class="studio-left">
            <h2 class="studio-title">The Studio</h2>
            <p class="studio-body">
              Resizing is a web design studio for small and scaling businesses that want a professional online presence without the headache. Most of our clients aren't trying to become bloggers or spend weekends wrestling with WordPress — they just need a fast, reliable site that looks sharp, brings in leads, and gets out of the way so they can focus on actually running their business.
            </p>
            <a href="/studio" class="studio-link">More about us →</a>
          </div>
          <div class="studio-right">
            <video class="studio-video" autoplay muted loop playsinline preload="metadata" aria-label="Studio photo dump">
              <source src="/photodump.mp4" type="video/mp4" />
            </video>
          </div>
        </div>
      </section>

      <!-- Vertical Navigation on the right -->
      <nav class="vertical-nav">
        <a href="/studio" class="nav-item">Studio</a>
        <a href="#work" class="nav-item">Work</a>
        <a href="/contact" class="nav-item">Contact</a>
        <CursorSwitcher />
      </nav>
    </div>

    <!-- Spacer creates scroll room for the pin phase -->
    <div class="scroll-pin-spacer"></div>
  </div>
</Base>

<style is:global>
  .page__main:has(.page-layout) {
    padding-left: 0 !important;
    padding-right: 0 !important;
  }
</style>

<style>
  /* Page Layout */
  .page-layout {
    position: relative;
    min-height: 100vh;
    padding: 10px;
    overflow-x: hidden;
    max-width: 100%;
  }

  /* Sticky wrapper: pins all content while the spacer scrolls behind.
     top: 10px matches the parent's padding so the pin is immediate —
     no natural scroll before the sticky threshold. */
  .page-content {
    position: sticky;
    top: 10px;
    z-index: 1;
    overflow-x: visible;
    max-width: 100%;
  }

  /* Creates extra scroll height so the page can "scroll"
     while content stays pinned (matches LOGO_SHRINK_RANGE in JS) */
  .scroll-pin-spacer {
    height: 200px;
    pointer-events: none;
  }

  /* Header Brand — visible immediately for LCP, slide-up only (no opacity delay) */
  .header-brand {
    position: sticky;
    top: 10px;
    z-index: 101;
    animation: slideUp 0.5s ease-out forwards;
    margin-bottom: 12px;
    will-change: transform, position;
    transition: transform 0.3s ease-out;
    pointer-events: none;

    /* JS-controlled custom properties for the header bar */
    --header-line-top: 78px;
    --header-opacity: 0;
    --header-translate-y: 0px;
  }

  /* When fully shrunk, remove sticky positioning and move out of view */
  .header-brand.shrunk {
    position: relative;
    transform: translateY(var(--header-translate-y));
  }

  /* White background — masks content scrolling behind the header */
  .header-brand::before {
    content: '';
    position: absolute;
    top: -10px;                /* reach viewport top */
    left: -10px;
    width: 100vw;
    height: calc(var(--header-line-top) + 14px); /* cover logo + line + buffer */
    background: #fff;
    opacity: var(--header-opacity);
    z-index: -1;
    pointer-events: none;
  }

  /* Divider line — sits at the visual bottom of the shrunken logo */
  .header-brand::after {
    content: '';
    position: absolute;
    top: var(--header-line-top);
    left: -10px;
    width: 100vw;
    height: 1px;
    background: rgba(0, 0, 0, 0.12);
    opacity: var(--header-opacity);
    pointer-events: none;
  }

  .logo-text {
    font-size: 115px;
    font-weight: 600;
    letter-spacing: -0.03em;
    line-height: 1;
    display: block;
    color: #000;
    font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    transform-origin: top left;
    will-change: transform;
    position: relative;
    z-index: 1;
    pointer-events: auto;
    cursor: pointer;
    text-decoration: none;
  }

  /* Vertical Navigation on Right */
  .vertical-nav {
    position: fixed;
    top: 10px;
    right: 10px;
    display: flex;
    flex-direction: column;
    align-items: flex-end;
    gap: 4px;
    z-index: 10000;
    pointer-events: auto;
  }

  .nav-item,
  .vertical-nav > :global(*) {
    transition: opacity 0.2s ease-out, transform 0.2s ease-out;
  }

  .nav-item {
    font-size: 20px;
    font-weight: 600;
    color: #000;
    text-decoration: none;
    text-align: right;
    line-height: 1.4;
    position: relative;
    transition: color 0.2s ease;
    pointer-events: auto;
    cursor: pointer;
  }

  .nav-item:hover {
    color: var(--link);
  }

  .nav-item::after {
    content: '';
    position: absolute;
    left: 0;
    right: 0;
    bottom: -2px;
    height: 2px;
    background: var(--link);
    transform: scaleY(0);
    transform-origin: bottom;
    transition: transform 0.2s ease-out;
  }

  .nav-item:hover::after {
    transform: scaleY(1);
  }

  /* Two Column Content Layout */
  .content-layout {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 80px;
    max-width: 1400px;
    margin: 0;
    padding: 0 0 0 0;
    padding-right: 240px; /* Space for fixed nav */
    min-width: 0; /* Allow grid to shrink below content size */
  }

  .content-left {
    display: flex;
    align-items: flex-start;
    justify-content: flex-start;
    min-width: 0; /* Allow shrinking to prevent overflow */
  }

  .text-content {
    max-width: min(400px, 100%);
    font-size: 72px; /* match logo-text size so children can use em units relative to it */
    display: flex;
    flex-direction: column;
    align-items: flex-start;
    gap: 12px;
  }

  .content-right {
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .description {
    font-size: 0.25em;
    font-weight: 400;
    margin: 0;
    line-height: 1.5;
    color: #525252;
    animation: fadeInUp 0.5s ease-out 0.15s forwards;
    opacity: 0;
  }

  .inquire-button {
    display: inline-block;
    padding: 0;
    background: none;
    color: var(--link);
    text-decoration: none;
    border-radius: 0;
    font-size: 13px;
    font-weight: 700;
    letter-spacing: 0.04em;
    text-transform: uppercase;
    transition: all 0.2s ease;
    border: none;
    border-bottom: 1.5px solid var(--link);
    padding-bottom: 2px;
    animation: fadeInUp 0.5s ease-out 0.5s forwards;
    opacity: 0;
    margin-top: 56px;
  }

  .inquire-button:hover {
    color: var(--link-hover);
    border-bottom-color: var(--link-hover);
  }

  .hero-divider {
    border: none;
    border-top: 1px solid rgba(0, 0, 0, 0.1);
    margin: 96px 0 0 0;
    width: 100vw;
    position: relative;
    left: 50%;
    right: 50%;
    margin-left: -50vw;
    margin-right: -50vw;
    animation: fadeInUp 0.5s ease-out 0.4s forwards;
    opacity: 0;
    z-index: 10;
    will-change: transform;
  }

  .services-section {
    padding: 36px 0 0 0;
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 40px;
    align-items: stretch;
    animation: fadeInUp 0.5s ease-out 0.5s forwards;
    opacity: 0;
  }

  .services-left {
    display: flex;
    flex-direction: column;
  }

  .services-right {
    display: flex;
    align-items: stretch;
    justify-content: center;
  }

  .services-video {
    width: 100%;
    max-width: 560px;
    height: 100%;
    object-fit: cover;
    border-radius: 4px;
    display: block;
  }

  .section-title {
    font-size: 31px;
    font-weight: 600;
    letter-spacing: -0.02em;
    line-height: 1.2;
    color: #000;
    margin: 0;
  }

  .section-body {
    margin-top: 20px;
    max-width: 560px;
    display: flex;
    flex-direction: column;
    gap: 16px;
    animation: fadeInUp 0.5s ease-out 0.6s forwards;
    opacity: 0;
  }

  .section-body p {
    font-size: 16px;
    font-weight: 400;
    line-height: 1.6;
    color: #444;
    margin: 0;
  }

  .highlight {
    color: var(--link);
    font-weight: 500;
  }

  /* Above Fold Wrapper */
  .above-fold {
    min-height: 100vh;
    box-sizing: border-box;
    will-change: transform;
    overflow-x: clip;
    overflow-y: visible;
  }

  /* Cards Section */
  .cards-section {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 10px;
    margin-top: 0;
    width: 100vw;
    position: relative;
    left: 50%;
    right: 50%;
    margin-left: -50vw;
    margin-right: -50vw;
    padding: 10px;
    box-sizing: border-box;
    animation: fadeInUp 0.5s ease-out 0.7s forwards;
    opacity: 0;
  }

  .cards-section-title {
    grid-column: 1 / -1;
    font-size: 31px;
    font-weight: 700;
    color: #000;
    margin: 0 0 10px 0;
    padding-left: 0;
  }

  .card {
    background: #f5f5f5;
    border-radius: 10px;
    padding: 32px 28px;
    display: flex;
    flex-direction: column;
    gap: 0;
  }

  .card-number {
    font-size: 13px;
    font-weight: 400;
    color: #999;
    letter-spacing: 0.02em;
    margin-bottom: 8px;
  }

  .card-title {
    font-size: 24px;
    font-weight: 600;
    color: #000;
    margin: 0 0 20px 0;
    letter-spacing: -0.01em;
    line-height: 1.2;
  }

  .card-body {
    font-size: 14px;
    font-weight: 400;
    line-height: 1.65;
    color: #555;
    margin: 0;
  }

  .card-price {
    font-size: 14px;
    font-weight: 600;
    color: #000;
    margin: 12px 0 0 0;
  }

  /* The Studio Section */
  .studio-section {
    margin-top: 80px;
    padding: 40px 0 16px;
  }

  .studio-inner {
    display: grid;
    grid-template-columns: 1fr 1fr;
    justify-content: start;
    gap: 40px;
    align-items: start;
  }

  .studio-left {
    display: flex;
    flex-direction: column;
    gap: 16px;
  }

  .studio-title {
    font-size: 36px;
    font-weight: 600;
    letter-spacing: -0.02em;
    line-height: 1.2;
    color: #000;
    margin: 0 0 8px 0;
  }

  .studio-body {
    font-size: 16px;
    font-weight: 400;
    line-height: 1.6;
    color: #444;
    margin: 0;
    max-width: 480px;
  }

  .studio-link {
    display: inline-block;
    align-self: flex-start;
    margin-top: 8px;
    font-size: 14px;
    font-weight: 600;
    color: var(--link);
    text-decoration: none;
    border-bottom: 1px solid var(--link);
    padding-bottom: 1px;
    transition: all 0.2s ease;
  }

  .studio-link:hover {
    color: var(--link-hover);
    border-bottom-color: var(--link-hover);
  }

  .studio-right {
    display: flex;
    align-items: flex-start;
    justify-content: center;
  }

  .studio-video {
    width: 100%;
    max-width: 420px;
    height: auto;
    border-radius: 4px;
    display: block;
  }

  /* Showcased Work Section */
  .showcased-work-section {
    margin-top: 80px;
    margin-left: -10px;
    margin-right: -10px;
    width: calc(100% + 20px);
    padding: 24px 0 60px 0;
    animation: fadeInUp 0.5s ease-out 0.9s forwards;
    opacity: 0;
  }

  .showcased-title {
    font-size: 36px;
    font-weight: 600;
    letter-spacing: -0.02em;
    line-height: 1.2;
    color: #000;
    margin: 0 0 24px 0;
  }

  .work-table {
    display: flex;
    flex-direction: column;
    gap: 0;
    padding: 0 10px;
  }

  .table-header,
  .row-summary {
    display: grid;
    grid-template-columns: 100px 1fr 1fr 1fr;
    gap: 32px;
    padding: 10px 0;
    border-bottom: 1px solid rgba(0, 0, 0, 0.1);
  }

  .table-header {
    border-bottom: 1px solid rgba(0, 0, 0, 0.1);
    padding: 6px 0 8px 0;
  }

  .table-header > div {
    font-size: 11px;
    font-weight: 600;
    letter-spacing: 0.08em;
    text-transform: uppercase;
    color: #999;
  }

  .table-row {
    list-style: none;
    border-bottom: 1px solid rgba(0, 0, 0, 0.1);
  }

  .row-summary {
    cursor: pointer;
    transition: background 0.2s ease;
    border-bottom: none;
    width: 100%;
    background: none;
    border: none;
    text-align: left;
    font: inherit;
    color: inherit;
    padding: 0;
  }

  .row-summary::-webkit-details-marker {
    display: none;
  }

  .row-summary:hover {
    background: rgba(0, 0, 0, 0.02);
  }

  .table-row.is-open .row-summary {
    border-bottom: 1px solid rgba(0, 0, 0, 0.1);
  }

  .col-year,
  .col-client,
  .col-type,
  .col-tech {
    font-size: 14px;
    font-weight: 400;
    line-height: 1.6;
    color: #000;
  }

  .col-year {
    color: #999;
  }

  .col-tech {
    color: #666;
  }

  .row-details {
    overflow-x: clip;
    overflow-y: hidden;
    max-height: 0;
    opacity: 0;
    transition: max-height 0.5s cubic-bezier(0.4, 0, 0.2, 1),
                opacity 0.4s ease;
  }

  .table-row.is-open .row-details {
    opacity: 1;
    overflow-x: clip;
    max-height: none;
  }

  .details-content {
    max-width: 1600px;
    padding: 12px 0;
    position: relative;
  }

  .details-description {
    font-size: 15px;
    line-height: 1.7;
    color: #333;
    margin-bottom: 12px;
  }

  .details-images {
    display: flex;
    flex-direction: row; /* side-by-side on wide screens */
    gap: 12px;
    margin-bottom: 12px;
    margin-left: -10px;
    margin-right: -10px;
    width: calc(100% + 20px);
    max-width: none;
    padding: 0;
    overflow-x: hidden;
    box-sizing: border-box;
    align-items: flex-start;
    justify-content: center;
    --images: 1; /* fallback */
    height: auto;
  }

  .details-images--3 {
    --images: 3;
  }

  .details-images img {
    display: block;
    height: auto;
    width: auto;
    max-width: calc((100% - (var(--images) - 1) * 12px) / var(--images));
    object-fit: contain;
    border-radius: 4px;
    border: 1px solid rgba(0, 0, 0, 0.08);
  }

  .visit-site-btn {
    display: inline-block;
    padding: 10px 20px;
    font-size: 14px;
    font-weight: 500;
    color: var(--link);
    border: 1px solid var(--link);
    border-radius: 4px;
    text-decoration: none;
    transition: all 0.2s ease;
  }

  .visit-site-btn:hover {
    background: var(--link);
    color: #fff;
    border-color: var(--link);
  }

  .reach-out-button {
    display: inline-block;
    padding: 12px 24px;
    font-size: 14px;
    font-weight: 600;
    color: #fff;
    background: var(--link);
    border-radius: 24px;
    text-decoration: none;
    transition: all 0.2s ease;
    margin-top: 20px;
    align-self: flex-start;
  }

  .reach-out-button:hover {
    background: var(--link-hover);
    transform: translateY(-1px);
  }

  @keyframes slideUp {
    from { transform: translateY(20px); }
    to { transform: translateY(0); }
  }

  @keyframes fadeInUp {
    from {
      opacity: 0;
      transform: translateY(20px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  /* Responsive Design */
  @media (max-width: 1024px) {
    .content-layout {
      grid-template-columns: 1fr;
      gap: 40px;
      padding: 0;
      padding-right: 0;
    }

    .services-section {
      grid-template-columns: 1fr;
      gap: 40px;
    }

    .cards-section {
      grid-template-columns: 1fr;
      margin-top: 48px;
    }

    .studio-inner {
      grid-template-columns: 1fr;
      gap: 40px;
    }

    .studio-right {
      justify-content: flex-start;
    }

    .table-header,
    .row-summary {
      grid-template-columns: 80px 1fr 1fr 1fr;
      gap: 16px;
      font-size: 13px;
    }

    .table-header > div {
      font-size: 10px;
    }

    .vertical-nav {
      position: static;
      align-items: flex-start;
      margin-top: 40px;
      z-index: 10000;
      pointer-events: auto;
    }

    .text-content {
      max-width: 400px;
    }
  }

  @media (max-width: 768px) {
    .page-layout {
      padding: 8px 10px;
    }

    .content-layout {
      padding: 0;
      max-width: 100%;
    }

    .vertical-nav {
      right: 10px;
      z-index: 10000;
      pointer-events: auto;
    }

    .text-content {
      font-size: 48px;
      max-width: 100%;
    }

    .logo-text {
      font-size: 96px;
    }


    .description {
      margin-bottom: 0;
    }

    .inquire-button {
      padding: 6px 14px !important;
      font-size: 12px;
    }

    .showcased-work-section {
      margin-top: 60px;
      margin-left: -10px;
      margin-right: -10px;
      width: calc(100% + 20px);
      padding: 16px 0 40px;
    }

    .showcased-title {
      font-size: 28px;
      margin-bottom: 12px;
      padding: 0 10px;
    }

    .table-header {
      display: none;
    }

    .work-table {
      padding: 0;
    }

    .row-summary {
      grid-template-columns: 1fr;
      gap: 4px;
      padding: 12px 10px;
    }

    .details-content {
      padding: 8px 10px 12px;
    }

    .details-description {
      margin-bottom: 8px;
    }

    .col-year,
    .col-client,
    .col-type,
    .col-tech {
      font-size: 13px;
    }

    .col-client {
      font-weight: 600;
      margin-bottom: 0;
    }

    .details-images {
      flex-direction: column;
      width: 100%;
      margin-left: 0;
      margin-right: 0;
      gap: 8px;
      margin-bottom: 8px;
      height: auto; /* stacked — let images size individually */
    }
    .details-images img {
      width: auto;
      max-width: 100%;
      height: auto;
      object-fit: contain;
      min-width: 0;
    }
  }
</style>

<script>
  function initScrollEffects() {
    const logo = document.querySelector('.logo-text') as HTMLElement | null;
    const headerBrand = document.querySelector('.header-brand') as HTMLElement | null;
    const aboveFold = document.querySelector('.above-fold') as HTMLElement | null;
    const heroDivider = document.querySelector('.hero-divider') as HTMLElement | null;
    const nav = document.querySelector('.vertical-nav') as HTMLElement | null;

    if (!logo || !headerBrand || !aboveFold || !nav) return;

    const children = Array.from(nav.children) as HTMLElement[];
    const gap = 4; // matches the CSS gap on .vertical-nav

    // Measure each nav item's natural height at init
    const heights = children.map(el => el.offsetHeight);

    // The logo's layout height (font-size × line-height 1 = 78px)
    const LOGO_HEIGHT = logo.offsetHeight;

    // ── Logo shrink configuration ──
    const LOGO_SHRINK_START = 0;     // begin shrinking immediately
    const LOGO_SHRINK_RANGE = 200;   // scroll px over which logo shrinks (matches scroll-pin-spacer)
    const MIN_SCALE = 0.32;          // minimum scale (~25px from 78px)

    // ── Nav fade configuration (delayed until logo shrink completes) ──
    const NAV_SCROLL_START = LOGO_SHRINK_START + LOGO_SHRINK_RANGE;
    const FADE_RANGE = 25;           // scroll px for an item to fade out
    const COLLAPSE_RANGE = 20;       // scroll px for items below to move up
    const SLIDE_PX = 8;              // small upward drift during fade
    const STEP = FADE_RANGE + COLLAPSE_RANGE;

    // ── Header bar fade-in range (px the divider travels to fully reveal the header) ──
    const HEADER_FADE_PX = 30;

    function getLogoScale(scrollY: number): number {
      if (scrollY <= LOGO_SHRINK_START) return 1;
      if (scrollY >= LOGO_SHRINK_START + LOGO_SHRINK_RANGE) return MIN_SCALE;
      const progress = (scrollY - LOGO_SHRINK_START) / LOGO_SHRINK_RANGE;
      return 1 - progress * (1 - MIN_SCALE);
    }

    function getFadeProgress(scrollY: number, i: number): number {
      const fadeStart = NAV_SCROLL_START + i * STEP;
      if (scrollY <= fadeStart) return 0;
      if (scrollY >= fadeStart + FADE_RANGE) return 1;
      return (scrollY - fadeStart) / FADE_RANGE;
    }

    function getCollapseProgress(scrollY: number, i: number): number {
      const collapseStart = NAV_SCROLL_START + i * STEP + FADE_RANGE;
      if (scrollY <= collapseStart) return 0;
      if (scrollY >= collapseStart + COLLAPSE_RANGE) return 1;
      return (scrollY - collapseStart) / COLLAPSE_RANGE;
    }

    function onScroll() {
      const scrollY = window.scrollY;

      // ── Batch all layout reads before any writes (avoids forced reflow) ──
      const dividerTop = heroDivider ? heroDivider.getBoundingClientRect().top : 0;

      // ── Logo scaling (top-left anchored via transform-origin) ──
      const scale = getLogoScale(scrollY);
      logo.style.transform = `scale(${scale})`;

      // ── Once logo is fully shrunk, remove sticky and move out of view ──
      const isFullyShrunk = scrollY >= LOGO_SHRINK_START + LOGO_SHRINK_RANGE;
      if (isFullyShrunk) {
        headerBrand.classList.add('shrunk');
        // Move it up and out of view (negative translateY)
        const translateOut = -100; // Adjust this value to control how far it goes up
        headerBrand.style.setProperty('--header-translate-y', `${translateOut}px`);
      } else {
        headerBrand.classList.remove('shrunk');
        headerBrand.style.setProperty('--header-translate-y', '0px');
      }

      // ── Move content up to stay with the shrinking logo ──
      const gapToClose = LOGO_HEIGHT * (1 - scale);
      aboveFold.style.transform = `translateY(-${gapToClose}px)`;

      // ── Header bar: position the line at the visual bottom of the logo + small gap ──
      const visualLogoBottom = LOGO_HEIGHT * scale + 4; // 4px gap below text
      headerBrand.style.setProperty('--header-line-top', `${visualLogoBottom}px`);

      // ── Header bar: fade in as the hero-divider reaches the header area ──
      if (heroDivider) {
        const headerLineY = 10 + visualLogoBottom;

        if (dividerTop <= headerLineY + HEADER_FADE_PX) {
          const progress = Math.min(
            1,
            Math.max(0, (headerLineY + HEADER_FADE_PX - dividerTop) / HEADER_FADE_PX)
          );
          headerBrand.style.setProperty('--header-opacity', String(progress));
        } else {
          headerBrand.style.setProperty('--header-opacity', '0');
        }
      }

      // ── Nav fading (only starts after logo shrink finishes) ──
      children.forEach((el, i) => {
        const fadeProgress = getFadeProgress(scrollY, i);

        let collapseOffset = 0;
        for (let j = 0; j < i; j++) {
          collapseOffset += (heights[j] + gap) * getCollapseProgress(scrollY, j);
        }

        const ownSlide = fadeProgress * SLIDE_PX;
        const totalY = collapseOffset + ownSlide;

        el.style.opacity = String(1 - fadeProgress);
        el.style.transform = `translateY(-${totalY}px)`;
        el.style.pointerEvents = fadeProgress >= 1 ? 'none' : 'auto';
      });
    }

    let rafId: number | null = null;
    function onScrollThrottled() {
      if (rafId !== null) return;
      rafId = requestAnimationFrame(() => {
        onScroll();
        rafId = null;
      });
    }
    window.addEventListener('scroll', onScrollThrottled, { passive: true });
    onScroll();
  }

  function runWhenIdle() {
    initScrollEffects();
    initWorkAccordion();
  }
  if ('requestIdleCallback' in window) {
    (window as any).requestIdleCallback(runWhenIdle, { timeout: 400 });
  } else {
    setTimeout(runWhenIdle, 0);
  }

  // ── Work accordion ──
  function initWorkAccordion() {
    const rows = document.querySelectorAll<HTMLElement>('.table-row[data-accordion]');

    rows.forEach(row => {
      const btn = row.querySelector<HTMLButtonElement>('.row-summary');
      const panel = row.querySelector<HTMLElement>('.row-details');
      if (!btn || !panel) return;

      btn.addEventListener('click', () => {
        const isOpen = row.classList.contains('is-open');

        // Close all others
        rows.forEach(other => {
          if (other !== row && other.classList.contains('is-open')) {
            const otherPanel = other.querySelector<HTMLElement>('.row-details');
            const otherBtn = other.querySelector<HTMLButtonElement>('.row-summary');
            if (otherPanel) {
              otherPanel.style.maxHeight = otherPanel.scrollHeight + 'px';
              requestAnimationFrame(() => {
                otherPanel.style.maxHeight = '0';
              });
            }
            other.classList.remove('is-open');
            otherBtn?.setAttribute('aria-expanded', 'false');
          }
        });

        if (isOpen) {
          // Close this one
          panel.style.maxHeight = panel.scrollHeight + 'px';
          requestAnimationFrame(() => {
            panel.style.maxHeight = '0';
          });
          row.classList.remove('is-open');
          btn.setAttribute('aria-expanded', 'false');
        } else {
          // Open this one — when collapsed, scrollHeight can be 0, so measure first
          let targetHeight = panel.scrollHeight;
          if (targetHeight === 0) {
            const content = panel.querySelector<HTMLElement>('.details-content');
            targetHeight = content ? content.scrollHeight : 0;
          }
          if (targetHeight === 0) {
            panel.style.maxHeight = 'none';
            targetHeight = panel.scrollHeight;
            panel.style.maxHeight = '0';
            void panel.offsetHeight; // force reflow
          }
          if (targetHeight === 0) targetHeight = 400; // fallback if content not yet laid out
          panel.style.maxHeight = targetHeight + 'px';
          row.classList.add('is-open');
          btn.setAttribute('aria-expanded', 'true');

          // Remove inline max-height after transition so content can reflow
          panel.addEventListener('transitionend', function handler() {
            if (row.classList.contains('is-open')) {
              panel.style.maxHeight = 'none';
            }
            panel.removeEventListener('transitionend', handler);
          });
        }
      });
    });

    // First row is already open in HTML; just ensure handlers are attached
  }

  // Autoplay video after 2 seconds
  setTimeout(() => {
    const video = document.getElementById('services-video') as HTMLVideoElement;
    if (video) {
      video.play();
    }
  }, 2000);

  // Smooth scroll for vertical nav anchor links (800ms for a gentler feel)
  function smoothScrollTo(targetPosition, duration = 800) {
    const start = window.pageYOffset;
    const distance = targetPosition - start;
    const startTime = performance.now();
    function step(currentTime) {
      const elapsed = currentTime - startTime;
      const progress = Math.min(elapsed / duration, 1);
      const ease = progress < 0.5 ? 4 * progress * progress * progress : 1 - Math.pow(-2 * progress + 2, 3) / 2;
      window.scrollTo(0, start + distance * ease);
      if (progress < 1) requestAnimationFrame(step);
    }
    requestAnimationFrame(step);
  }
  document.querySelectorAll('.vertical-nav a[href^="#"]').forEach(anchor => {
    anchor.addEventListener('click', function(e) {
      e.preventDefault();
      const href = anchor.getAttribute('href');
      if (!href) return;
      
      const targetId = href.substring(1);
      const target = document.getElementById(targetId);
      
      if (target) {
        const targetPosition = target.getBoundingClientRect().top + window.pageYOffset;
        smoothScrollTo(targetPosition);
        // Update URL without triggering navigation
        history.pushState(null, '', href);
      }
    });
  });
</script>
